<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bug Tracker</title>
    <style>
        .closed{
            color : red;
            text-decoration: line-through;
            font-style: italic;
            font-weight: bold;
        }
        li{
            list-style: none;
            margin-bottom: 5px;
            border : 2px solid gray;
            padding : 4px;
            background-color: lightgray;
            cursor: pointer;
            border-radius: 4px;
            margin-left: 0px;
        }
        ol{
            width : 50%;
            padding : 0px;
        }
        section{
            margin-bottom: 5px;
        }
        .bugName {
            padding-top: 0px;
            margin-top: 0px;
        }
    </style>
    <script src="angular.js"></script>
    <script>
    /*
    1. List all the bugs
    2. Add a new bug
    3. Toggle the closed status of the bugs
    4. Remove closed bugs
    5. Search for the bugs
    6. Sort the bugs
    7. Display stats
    8. Display the createdAt for each bug
    9. Persist the bugs in the localStorage
    10. Persist the bugs in the server
    */

    /*
    window.localStorage
        - persistent store
        - same origin policy for security
        - key/value store
        - key should be unique
        - both key and value should be strings
            (for objects,
                use angular.toJson(obj) to convert the obj to string
                use angular.fromJson(str) to convert the json string to object
            )
        - for key generation using Date.now().toStrin()

        APIs
            - setItem(key,value)
            - getItem(key) // => value
            - removeItem(key)
            - key(index) //=> key
            - clear()
            - length
    */


        var bugTrackerApp = angular.module("bugTrackerApp", []);

        bugTrackerApp.controller("bugsController", function($scope){
            $scope.newBug = '';
            $scope.bugs = [
                { id : "1434684600000", name : "User authentication failure", isClosed : false, createdAt : new Date(2015,5,19,9,0,0)},
                { id : "1434691800000", name : "Data not persisting in the server", isClosed : false, createdAt : new Date(2015,5,19,11,0,0)},
                { id : "1434511800000", name : "Application not responsive", isClosed : false, createdAt : new Date(2015,5,17,9,0,0)},
                { id : "1434512800000", name : "Application is hardly reliable", isClosed : false, createdAt : new Date(2015,5,9,9,0,0)},
                { id : "1434231800000", name : "Authorization has stopped working", isClosed : false, createdAt : new Date(2015,3,19,9,0,0)},
            ];
            $scope.addNew = function(){
                $scope.bugs.push($scope.newBug);
            };
            $scope.toggle = function(bug){
                bug.isClosed = !bug.isClosed;
            };

            $scope.removeClosed = function(){
                for(var i=$scope.bugs.length-1; i>=0; i--){
                    var bug = $scope.bugs[i];
                    if (bug.isClosed){
                        $scope.bugs.splice(i,1);
                    }
                }
            };

            $scope.getClosedCount = function(){
                return $scope.bugs.filter(function(bug){
                    return bug.isClosed;
                }).length;
            };


        });

    </script>

</head>
<body ng-app="bugTrackerApp">
    <h1>Bug Tracker</h1>
    <div class="content" ng-controller="bugsController">
        <section class="stats">
            <h3> <span class="closed">{{getClosedCount()}}</span> / {{bugs.length}} </h3>
        </section>
        <section class="search">
            <label for="">Search</label>
            <input type="text" ng-model="searchBug.name">
            <label for="">Sort :</label>
            <select ng-model="sortField">
                <option value="name">name</option>
                <option value="isClosed">isClosed</option>
            </select>

            <span>Descending ?</span>
            <input type="checkbox" ng-model="isDescending">
        </section>
        <section class="editor">
            <label for="">Bug :</label>
            <input type="text" ng-model="newBug">
            <input type="button" value="Add Bug" ng-click="addNew()" >
            <input type="button" value="Remove Closed" ng-click="removeClosed()">
        </section>
        <section class="list">
            <ol>
                <li
                    ng-repeat="bug in bugs | filter:searchBug | orderBy:sortField:isDescending"
                >
                <h2 class="bugName" ng-click="toggle(bug)" ng-class="{closed : bug.isClosed}">{{bug.name}}</h2>
                <div>{{bug.createdAt | date}}</div>
                </li>
            </ol>
        </section>
    </div>
</body>
</html>
